<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PARNIKA | Weather & AQI Monitor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background: linear-gradient(to right, #e0f7fa, #ffffff);
      font-family: 'Segoe UI', sans-serif;
    }
    .card {
      border: none;
      background: #ffffff;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      border-radius: 20px;
    }
    h2, h4 {
      color: #2b6777;
    }
    .status-box {
      padding: 10px 20px;
      border-radius: 12px;
      display: inline-block;
      font-size: 1.1rem;
      background: #e8f5e9;
      color: #2e7d32;
    }
    .bg-blur {
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(10px);
    }
    .circle-container {
      position: relative;
      width: 180px;
      height: 180px;
      margin: 0 auto;
      animation: popIn 1s ease forwards;
    }
    @keyframes popIn {
      0% {
        transform: scale(0);
        opacity: 0;
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }
    canvas#aqiCircle {
      position: absolute;
      top: 0;
      left: 0;
    }
    .aqi-value-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.5rem;
      font-weight: bold;
      animation: fadeIn 1s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .clock {
      text-align: center;
      font-size: 1.25rem;
      margin-bottom: 20px;
      color: #555;
      animation: blink 1s step-end infinite;
    }
    @keyframes blink { 50% { opacity: 0.5; } }

    .back-btn {
      display: inline-block;
      padding: 8px 20px;
      margin-bottom: 15px;
      background: #2b6777;
      color: #fff;
      border-radius: 30px;
      text-decoration: none;
      transition: background 0.3s ease;
    }
    .back-btn:hover {
      background: #1f4f5a;
    }
  </style>
</head>
<body>

  <div class="container my-5">
    <a href="frontpage.html" class="back-btn">‚¨Ö Back</a>
    <h2 class="text-center mb-4">üå§Ô∏è Weather & üè≠ Air Quality Monitor</h2>

    <div class="clock" id="clock">--:--:--</div>

    <div class="card p-4 mb-4 bg-blur">
      <h4 class="mb-3">Current Weather</h4>
      <div id="weather" class="row text-center">
        <div class="col-md-3">
          <img src="https://www.freeiconspng.com/uploads/location-icon-png-14.png" alt="Location Icon" class="rounded-circle border shadow mb-2" width="60" height="60">
          <br><strong>üìç Location:</strong><br> <span id="location">Detecting...</span>
        </div>
        <div class="col-md-3">
          <img src="https://www.pngplay.com/wp-content/uploads/8/Climate-Temperature-PNG-Clipart-Background.png" alt="Temperature Icon" class="rounded-circle border shadow mb-2" width="60" height="60">
          <br><strong>üå°Ô∏è Temperature:</strong><br> <span id="temp">--</span>¬∞C
        </div>
        <div class="col-md-3">
          <img src="https://cdn-icons-png.flaticon.com/512/4148/4148460.png" alt="Humidity Icon" class="rounded-circle border shadow mb-2" width="60" height="60">
          <br><strong>üíß Humidity:</strong><br> <span id="humidity">--</span>%
        </div>
        <div class="col-md-3">
          <img id="weather-icon" src="" alt="Weather Icon" class="rounded-circle border shadow mb-2" width="60" height="60">
          <br><strong>üå•Ô∏è Condition:</strong><br> <span id="condition">--</span>
        </div>
      </div>
    </div>

    <div class="card p-4 bg-blur mb-4">
      <h4 class="mb-3">Air Quality Index (AQI)</h4>
      <div class="circle-container">
        <canvas id="aqiCircle" width="180" height="180"></canvas>
        <div class="aqi-value-text" id="aqi-text">--</div>
      </div>
      <div class="text-center mt-3">
        <span id="aqi-status" class="status-box">Loading AQI...</span>
      </div>
    </div>

    <div class="card p-4 bg-blur mb-4">
      <h4 class="mb-3">ü©∫ Health Tips Based on AQI</h4>
      <p id="health-tip">Loading tip...</p>
    </div>

    <div class="card p-4 bg-blur">
      <h4 class="mb-3">üçΩÔ∏è Food Recommendations Based on Weather</h4>
      <p id="food-tip">Loading suggestion...</p>
    </div>
  </div>

  <script>
    const apiKey = "da0cd6eb81aacdd0864ddae13212a9de";

    const aqiTips = {
      1: "Air quality is good. Enjoy your outdoor activities!",
      2: "Fair air. Safe for most, but watch for symptoms if you're sensitive.",
      3: "Moderate. Avoid intense outdoor activity if unwell.",
      4: "Poor. Wear a mask and avoid outdoor exertion.",
      5: "Very Poor. Stay indoors and use air purifiers if possible."
    };

    const foodSuggestions = {
      hot: "It's warm outside! Stay hydrated with cold beverages and enjoy salads or light meals like cucumber sandwiches.",
      cold: "Chilly weather! Warm up with soups, stews, or a hot cup of tea.",
      rain: "Rainy day? Try pakoras, samosas, and a hot cup of chai.",
      moderate: "Mild weather is perfect for enjoying your favorite balanced meals."
    };

    function updateClock() {
      const now = new Date();
      const timeStr = now.toLocaleTimeString();
      document.getElementById("clock").textContent = timeStr;
    }
    setInterval(updateClock, 1000);
    updateClock();

    function suggestFood(temp, condition) {
      if (condition.toLowerCase().includes("rain")) {
        return foodSuggestions.rain;
      } else if (temp <= 15) {
        return foodSuggestions.cold;
      } else if (temp >= 30) {
        return foodSuggestions.hot;
      } else {
        return foodSuggestions.moderate;
      }
    }

    async function fetchWeatherAndAQI(lat, lon) {
      try {
        const weatherRes = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${apiKey}`);
        const weatherData = await weatherRes.json();

        const city = weatherData.name || `Lat: ${lat}, Lon: ${lon}`;
        const temp = weatherData.main.temp;
        const condition = weatherData.weather[0].main;

        document.getElementById("location").textContent = city;
        document.getElementById("temp").textContent = temp;
        document.getElementById("humidity").textContent = weatherData.main.humidity;
        document.getElementById("condition").textContent = condition;
        document.getElementById("weather-icon").src = `http://openweathermap.org/img/wn/${weatherData.weather[0].icon}@2x.png`;

        document.getElementById("food-tip").textContent = suggestFood(temp, condition);

        const aqiRes = await fetch(`https://api.openweathermap.org/data/2.5/air_pollution?lat=${lat}&lon=${lon}&appid=${apiKey}`);
        const aqiData = await aqiRes.json();
        const aqi = aqiData?.list?.[0]?.main?.aqi || 0;

        const aqiBox = document.getElementById("aqi-status");
        const aqiText = document.getElementById("aqi-text");
        aqiText.textContent = aqi > 0 ? aqi : "--";

        const statusMap = {
          1: { text: "Good üòä", color: "#43a047", bg: "#e8f5e9" },
          2: { text: "Fair üôÇ", color: "#fbc02d", bg: "#fff9c4" },
          3: { text: "Moderate üòê", color: "#fb8c00", bg: "#ffe0b2" },
          4: { text: "Poor üò∑", color: "#e53935", bg: "#ffcdd2" },
          5: { text: "Very Poor ü§¢", color: "#8e24aa", bg: "#f3e5f5" }
        };

        if (aqi > 0) {
          const { text, bg, color } = statusMap[aqi];
          aqiBox.textContent = `AQI Level: ${aqi} (${text})`;
          aqiBox.style.backgroundColor = bg;
          aqiBox.style.color = color;
          document.getElementById("health-tip").textContent = aqiTips[aqi];

          const canvas = document.getElementById("aqiCircle");
          const ctx = canvas.getContext("2d");
          let progress = 0;
          const target = (aqi / 5) * 2 * Math.PI;

          function animateArc() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.beginPath();
            ctx.arc(90, 90, 70, -0.5 * Math.PI, -0.5 * Math.PI + progress);
            ctx.strokeStyle = color;
            ctx.lineWidth = 12;
            ctx.stroke();
            if (progress < target) {
              progress += 0.05;
              requestAnimationFrame(animateArc);
            }
          }
          animateArc();

        } else {
          aqiBox.textContent = "AQI data unavailable.";
          document.getElementById("health-tip").textContent = "No AQI tip available.";
        }

      } catch (error) {
        console.error("Error fetching data:", error);
        alert("Failed to fetch weather or AQI data.");
      }
    }

    navigator.geolocation.getCurrentPosition(
      (pos) => {
        const { latitude, longitude } = pos.coords;
        fetchWeatherAndAQI(latitude, longitude);
      },
      (err) => {
        fetchWeatherAndAQI(28.6139, 77.2090);
      }
    );
  </script>

</body>
</html>
